<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Address Geolocation Finder</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="../css/theme.css">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3527668902044321"
            crossorigin="anonymous"></script>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/images/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/images/favicon-16x16.png">
    <link rel="manifest" href="../assets/images/site.webmanifest">
</head>
<body>
    <!-- Dark Mode Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">
        <i class="material-icons theme-toggle-icon">dark_mode</i>
        <span class="theme-toggle-text">Dark</span>
    </button>


    <a href="../index.html" class="back-button" title="Back to Home"></a>
    
    <div class="page-wrapper">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <div class="ad-container vertical">
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-3527668902044321"
                     data-ad-slot="1234567890"
                     data-ad-format="rectangle"
                     data-full-width-responsive="true"></ins>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="container">
            <div class="header-logo">
        <img src="../../assets/images/1page-logo.png" alt="1Page Tools Logo" class="site-logo">
    </div>
    <header>
            <h1>IP Address Geolocation Finder</h1>
            <p class="subtitle">Find the geographical location of any IP address</p>
        </header>
        
        <div class="instructions">
            <h3>How to use:</h3>
            <ol>
                <li>Enter an IP address in the search field (e.g., 8.8.8.8 for Google DNS)</li>
                <li>Click "Locate IP" to find its geographical location</li>
                <li>Or click "Use My IP" to find your own location</li>
                <li>View the results on the map and information cards</li>
            </ol>
        </div>
        
        <div class="search-section">
            <div class="input-group">
                <label for="ipInput">IP Address</label>
                <div class="input-container">
                    <input type="text" id="ipInput" class="input-field" placeholder="Enter IP address (e.g., 8.8.8.8)">
                    <button class="btn" id="locateBtn">Locate IP</button>
                </div>
            </div>
            <button class="btn my-ip-btn" id="myIpBtn">Use My IP Address</button>
        </div>
        
        <div class="status" id="statusMessage"></div>
        
        <div class="results-section" id="resultsSection">
            <div class="info-cards">
                <div class="info-card">
                    <h3>IP Address</h3>
                    <div class="info-content" id="ipAddress">-</div>
                </div>
                <div class="info-card">
                    <h3>Location</h3>
                    <div class="info-content" id="location">-</div>
                </div>
                <div class="info-card">
                    <h3>ISP</h3>
                    <div class="info-content" id="isp">-</div>
                </div>
                <div class="info-card">
                    <h3>Timezone</h3>
                    <div class="info-content" id="timezone">-</div>
                </div>
            </div>
            
            <div class="map-container">
                <div id="map"></div>
            </div>
        </div>
        
    <div class="history-section hidden" id="historySection">
            <h3 class="history-title">Recent Searches</h3>
            <div class="history-container" id="historyContainer">
                <!-- History items will be added here -->
            </div>
        </div>
    </div>
    
    <footer>
        <p>This tool uses free geolocation APIs. Accuracy may vary depending on the IP address.</p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // DOM elements
        const ipInput = document.getElementById('ipInput');
        const locateBtn = document.getElementById('locateBtn');
        const myIpBtn = document.getElementById('myIpBtn');
        const statusMessage = document.getElementById('statusMessage');
        const resultsSection = document.getElementById('resultsSection');
        const historySection = document.getElementById('historySection');
        const historyContainer = document.getElementById('historyContainer');
        
        // Info display elements
        const ipAddressEl = document.getElementById('ipAddress');
        const locationEl = document.getElementById('location');
        const ispEl = document.getElementById('isp');
        const timezoneEl = document.getElementById('timezone');
        
        // Variables
        let map = null;
        let marker = null;
        let searchHistory = [];
        
        // Initialize
        function init() {
            // Load search history from localStorage
            loadSearchHistory();
            
            // Add event listeners
            locateBtn.addEventListener('click', handleLocateIp);
            myIpBtn.addEventListener('click', handleMyIp);
            ipInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleLocateIp();
                }
            });
            
            // Initialize map with a slight delay to ensure container is rendered
            setTimeout(() => {
                initMap(0, 0, 2);
            }, 100);
        }
        
        // Initialize the map
        function initMap(lat, lng, zoom) {
            if (map !== null) {
                map.remove();
            }
            
            // Create map with proper options
            map = L.map('map', {
                center: [lat, lng],
                zoom: zoom,
                zoomControl: true,
                attributionControl: true
            });
            
            // Add tile layer (OpenStreetMap)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 18
            }).addTo(map);
            
            // Force map to invalidate size and refresh
            setTimeout(() => {
                map.invalidateSize();
            }, 100);
        }
        
        // Add marker to the map
        function addMarker(lat, lng, title) {
            if (marker !== null) {
                map.removeLayer(marker);
            }
            
            marker = L.marker([lat, lng]).addTo(map)
                .bindPopup(title)
                .openPopup();
            
            // Center map on marker with animation
            map.setView([lat, lng], 10, {
                animate: true,
                duration: 1
            });
            
            // Ensure map tiles load properly
            setTimeout(() => {
                map.invalidateSize();
            }, 300);
        }
        
        // Handle IP location search
        async function handleLocateIp() {
            const ip = ipInput.value.trim();
            
            if (!ip) {
                showStatus('Please enter an IP address', 'error');
                return;
            }
            
            // Basic IP validation
            if (!isValidIP(ip)) {
                showStatus('Please enter a valid IP address', 'error');
                return;
            }
            
            await locateIP(ip);
        }
        
        // Handle "Use My IP" button
        async function handleMyIp() {
            ipInput.value = '';
            showStatus('Detecting your IP address...', 'info');
            locateBtn.disabled = true;
            myIpBtn.disabled = true;
            myIpBtn.innerHTML = '<span class="loading"></span>Detecting...';
            
            try {
                // First, get the user's IP address
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                const userIP = data.ip;
                
                ipInput.value = userIP;
                await locateIP(userIP);
            } catch (error) {
                showStatus('Failed to detect your IP address', 'error');
                console.error('Error detecting IP:', error);
            } finally {
                locateBtn.disabled = false;
                myIpBtn.disabled = false;
                myIpBtn.innerHTML = 'Use My IP Address';
            }
        }
        
        // Locate IP using geolocation API
        async function locateIP(ip) {
            showStatus('Locating IP address...', 'info');
            locateBtn.disabled = true;
            locateBtn.innerHTML = '<span class="loading"></span>Locating...';
            
            try {
                // Using ipapi.co API (free tier)
                const response = await fetch(`https://ipapi.co/${ip}/json/`);
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.reason || 'Unable to locate IP address');
                }
                
                // Display results
                displayResults(data);
                
                // Add to search history
                addToHistory(ip, data);
                
                showStatus('Location found successfully!', 'success');
            } catch (error) {
                showStatus('Error: ' + error.message, 'error');
                console.error('Error locating IP:', error);
                
                // Fallback API if the first one fails
                try {
                    showStatus('Trying alternative API...', 'info');
                    const fallbackResponse = await fetch(`http://ip-api.com/json/${ip}`);
                    const fallbackData = await fallbackResponse.json();
                    
                    if (fallbackData.status === 'success') {
                        displayResults({
                            ip: ip,
                            city: fallbackData.city,
                            country_name: fallbackData.country,
                            latitude: fallbackData.lat,
                            longitude: fallbackData.lon,
                            org: fallbackData.org,
                            timezone: fallbackData.timezone
                        });
                        addToHistory(ip, fallbackData);
                        showStatus('Location found using alternative API!', 'success');
                    } else {
                        throw new Error(fallbackData.message || 'Alternative API also failed');
                    }
                } catch (fallbackError) {
                    showStatus('All geolocation services failed. Please try again later.', 'error');
                }
            } finally {
                locateBtn.disabled = false;
                locateBtn.innerHTML = 'Locate IP';
            }
        }
        
        // Display results on the page
        function displayResults(data) {
            // Show results section
            resultsSection.style.display = 'block';
            
            // Update info cards
            ipAddressEl.textContent = data.ip || '-';
            locationEl.textContent = `${data.city || ''}${data.city && data.country_name ? ', ' : ''}${data.country_name || ''}`;
            ispEl.textContent = data.org || data.asn || '-';
            timezoneEl.textContent = data.timezone || '-';
            
            // Update map
            if (data.latitude && data.longitude) {
                const lat = parseFloat(data.latitude);
                const lng = parseFloat(data.longitude);
                const title = `${data.city || 'Unknown'}, ${data.country_name || 'Unknown'}`;
                
                addMarker(lat, lng, title);
                
                // Ensure map is properly displayed
                setTimeout(() => {
                    if (map) {
                        map.invalidateSize();
                    }
                }, 500);
            }
            
            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // Add IP to search history
        function addToHistory(ip, data) {
            // Remove if already in history
            searchHistory = searchHistory.filter(item => item.ip !== ip);
            
            // Add to beginning
            searchHistory.unshift({
                ip: ip,
                city: data.city,
                country: data.country_name,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 5 searches
            if (searchHistory.length > 5) {
                searchHistory.pop();
            }
            
            // Save to localStorage
            localStorage.setItem('ipSearchHistory', JSON.stringify(searchHistory));
            
            // Update history display
            updateHistoryDisplay();
        }
        
        // Load search history from localStorage
        function loadSearchHistory() {
            const savedHistory = localStorage.getItem('ipSearchHistory');
            if (savedHistory) {
                searchHistory = JSON.parse(savedHistory);
                updateHistoryDisplay();
            }
        }
        
        // Update history display
        function updateHistoryDisplay() {
            if (searchHistory.length === 0) {
                historySection.style.display = 'none';
                return;
            }
            
            historySection.style.display = 'block';
            historyContainer.innerHTML = '';
            
            searchHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                let displayText = item.ip;
                if (item.city && item.country) {
                    displayText += ` (${item.city}, ${item.country})`;
                }
                
                historyItem.textContent = displayText;
                historyItem.title = `Searched on ${new Date(item.timestamp).toLocaleString()}`;
                
                historyItem.addEventListener('click', () => {
                    ipInput.value = item.ip;
                    handleLocateIp();
                });
                
                historyContainer.appendChild(historyItem);
            });
        }
        
        // Show status message
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status status-${type}`;
            
            // Auto-hide success messages after 5 seconds
            if (type === 'success') {
                setTimeout(() => {
                    statusMessage.textContent = '';
                    statusMessage.className = 'status';
                }, 5000);
            }
        }
        
        // Validate IP address format
        function isValidIP(ip) {
            // IPv4 pattern
            const ipv4Pattern = /^(\d{1,3}\.){3}\d{1,3}$/;
            
            // IPv6 pattern (basic)
            const ipv6Pattern = /^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/;
            
            if (ipv4Pattern.test(ip)) {
                const parts = ip.split('.');
                for (let part of parts) {
                    if (parseInt(part) > 255) {
                        return false;
                    }
                }
                return true;
            }
            
            // For this demo, we'll accept any IPv6 format
            return ipv6Pattern.test(ip) || ip === 'localhost';
        }
        
        // Initialize the application
        init();
    </script>    <script>
        // Dark Mode Toggle Functionality
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Update toggle button
            updateThemeToggle(newTheme);
        }

        function updateThemeToggle(theme) {
            const icon = document.querySelector('.theme-toggle-icon');
            const text = document.querySelector('.theme-toggle-text');
            
            if (theme === 'dark') {
                icon.textContent = 'light_mode';
                text.textContent = 'Light';
            } else {
                icon.textContent = 'dark_mode';
                text.textContent = 'Dark';
            }
        }

        // Initialize theme on page load
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = savedTheme || (prefersDark ? 'dark' : 'light');
            
            document.documentElement.setAttribute('data-theme', theme);
            updateThemeToggle(theme);
        }

        // Initialize theme when page loads
        document.addEventListener('DOMContentLoaded', initializeTheme);
    </script>

</body>
    <footer class="site-footer">
        &copy; 2025 1page.tools<br>
        <a href="../privacy-policy.html" target="_blank">Privacy Policy</a> &middot; <a href="../terms-of-use.html" target="_blank">Terms of Use</a>
    </footer>    <script>
        // Dark Mode Toggle Functionality
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Update toggle button
            updateThemeToggle(newTheme);
        }

        function updateThemeToggle(theme) {
            const icon = document.querySelector('.theme-toggle-icon');
            const text = document.querySelector('.theme-toggle-text');
            
            if (theme === 'dark') {
                icon.textContent = 'light_mode';
                text.textContent = 'Light';
            } else {
                icon.textContent = 'dark_mode';
                text.textContent = 'Dark';
            }
        }

        // Initialize theme on page load
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = savedTheme || (prefersDark ? 'dark' : 'light');
            
            document.documentElement.setAttribute('data-theme', theme);
            updateThemeToggle(theme);
        }

        // Initialize theme when page loads
        document.addEventListener('DOMContentLoaded', initializeTheme);
    </script>

</body>
</html>